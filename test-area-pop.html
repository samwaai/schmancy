<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Area Pop Functionality</title>
    <script type="module">
        import './dist/area/index.js';
        import { area } from './dist/area/index.js';
        import { LitElement, html, css } from 'lit';
        import { customElement } from 'lit/decorators.js';

        // Create test components
        @customElement('test-component-a')
        class TestComponentA extends LitElement {
            static styles = css`
                :host {
                    display: block;
                    padding: 20px;
                    background: #e3f2fd;
                    border-radius: 8px;
                }
            `;

            render() {
                return html`
                    <h2>Component A</h2>
                    <p>This is test component A</p>
                `;
            }
        }

        @customElement('test-component-b')
        class TestComponentB extends LitElement {
            static styles = css`
                :host {
                    display: block;
                    padding: 20px;
                    background: #fff3e0;
                    border-radius: 8px;
                }
            `;

            render() {
                return html`
                    <h2>Component B</h2>
                    <p>This is test component B</p>
                `;
            }
        }

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', () => {
            // Add test controls
            const controls = document.getElementById('controls');

            // Push Component A button
            const pushABtn = document.createElement('button');
            pushABtn.textContent = 'Push Component A to main';
            pushABtn.onclick = () => {
                area.push({
                    area: 'main',
                    component: 'test-component-a',
                    state: { timestamp: Date.now() }
                });
                updateStatus();
            };
            controls.appendChild(pushABtn);

            // Push Component B button
            const pushBBtn = document.createElement('button');
            pushBBtn.textContent = 'Push Component B to main';
            pushBBtn.onclick = () => {
                area.push({
                    area: 'main',
                    component: 'test-component-b',
                    state: { timestamp: Date.now() }
                });
                updateStatus();
            };
            controls.appendChild(pushBBtn);

            // Pop main area button
            const popBtn = document.createElement('button');
            popBtn.textContent = 'Pop main area';
            popBtn.style.background = '#ffcdd2';
            popBtn.onclick = () => {
                console.log('Calling area.pop("main")...');
                area.pop('main');
                updateStatus();
            };
            controls.appendChild(popBtn);

            // Push to sidebar area
            const pushSidebarBtn = document.createElement('button');
            pushSidebarBtn.textContent = 'Push Component A to sidebar';
            pushSidebarBtn.onclick = () => {
                area.push({
                    area: 'sidebar',
                    component: 'test-component-a',
                    state: { location: 'sidebar' }
                });
                updateStatus();
            };
            controls.appendChild(pushSidebarBtn);

            // Pop sidebar area button
            const popSidebarBtn = document.createElement('button');
            popSidebarBtn.textContent = 'Pop sidebar area';
            popSidebarBtn.style.background = '#ffcdd2';
            popSidebarBtn.onclick = () => {
                console.log('Calling area.pop("sidebar")...');
                area.pop('sidebar');
                updateStatus();
            };
            controls.appendChild(popSidebarBtn);

            // Status display
            const statusDiv = document.createElement('div');
            statusDiv.id = 'status';
            statusDiv.style.marginTop = '20px';
            statusDiv.style.padding = '10px';
            statusDiv.style.background = '#f5f5f5';
            statusDiv.style.borderRadius = '4px';
            statusDiv.style.fontFamily = 'monospace';
            controls.appendChild(statusDiv);

            function updateStatus() {
                const areas = area.getActiveAreas();
                const status = areas.map(areaName => {
                    const route = area.getRoute(areaName);
                    return `${areaName}: ${route ? route.component : 'empty'}`;
                }).join('\n');

                statusDiv.innerHTML = `<strong>Active Areas:</strong><br>${status || 'None'}<br><br>` +
                    `<strong>Main area DOM:</strong> ${document.querySelector('schmancy-area[name="main"]')?.shadowRoot?.children[0]?.tagName || 'Empty'}<br>` +
                    `<strong>Sidebar area DOM:</strong> ${document.querySelector('schmancy-area[name="sidebar"]')?.shadowRoot?.children[0]?.tagName || 'Empty'}`;
            }

            // Subscribe to area changes
            area.$current.subscribe(current => {
                console.log('Area state changed:', current);
                updateStatus();
            });

            // Initial status
            updateStatus();
        });
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            background: #fafafa;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        #controls {
            margin-bottom: 30px;
        }

        #controls button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            background: #2196f3;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #controls button:hover {
            background: #1976d2;
        }

        .area-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .area-wrapper {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .area-wrapper h3 {
            margin-top: 0;
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        schmancy-area {
            min-height: 200px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Test Area Pop Functionality</h1>

    <div id="controls">
        <!-- Buttons will be added here -->
    </div>

    <div class="area-container">
        <div class="area-wrapper">
            <h3>Main Area</h3>
            <schmancy-area name="main"></schmancy-area>
        </div>

        <div class="area-wrapper">
            <h3>Sidebar Area</h3>
            <schmancy-area name="sidebar"></schmancy-area>
        </div>
    </div>
</body>
</html>